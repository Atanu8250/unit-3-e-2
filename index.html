<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home</title>
  <link rel="stylesheet" href="style/index.css">
</head>

<body>
  <div id="navbar">
    <div>login</div>
    <div>Sign-Up</div>
    <!-- Give cart link for navigation with id:- cart   -->
    <div id="cart"><a href="cart.html">Cart</a></div>
    <!-- For wallet amount Show only number i.e only "500", no extra text like "amount = 500" with id :- "wallet" -->
    <div id="wallet"></div>
  </div>

  <!--Show all groceries here in grid format-->
  <!-- add an add to cart button to each item, give it HTML class as 'add_to_cart' -->
  <div id="groceries">
    <img src="https://c.tenor.com/K2UGDd4acJUAAAAC/load-loading.gif">
  </div>
</body>
<script>

  let cart = JSON.parse(localStorage.getItem("cart_items")) || [];
  let wallet = document.querySelector("#wallet");

  async function groceries() {
    const url = "https://grocery-masai.herokuapp.com/items";
    let res = await fetch(url)
    let data = await res.json();
    let datas = data.data;
    console.log(datas)
    append(datas)
  }

  walletbalance()
  groceries()

  function append(datas) {
    let container = document.querySelector("#groceries");
    container.innerHTML = ""

    datas.forEach(function (el) {
      let box = document.createElement("div");
      let img = document.createElement("img");
      img.src = el.image;

      let name = document.createElement("h3");
      name.innerText = el.name;

      let price = document.createElement("p");
      price.innerHTML = `<b>Price: </b>${el.price}`;

      let cart = document.createElement("button");
      cart.innerText = 'Add to Cart';
      cart.setAttribute("class", "add_to_cart");
      cart.addEventListener("click", function () {
        addToCart(el)
      })

      container.append(box);
      box.append(img, name, price, cart);
    })
  }


  function walletbalance() {
    wallet.innerText = null;
    let sum = 0;
    cart.forEach(function (el) {
      sum += el.price;
    })
    wallet.innerText = 700 - sum;
  }

  function addToCart(el) {
    if (wallet.innerText >= el.price) {
      cart.push(el);
      localStorage.setItem("cart_items", JSON.stringify(cart));
    }else{
      alert("Insufficient balance")
    }
    walletbalance()
  }

</script>

</html>